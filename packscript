local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- Estados
local noclipEnabled = false
local flyEnabled = false
local infiniteHealthEnabled = false
local speedEnabled = false
local espEnabled = false
local flySpeed = 50
local walkSpeed = 16

-- GUI principal
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ModernGUI"
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Botão flutuante (bolinha com ícone)
local toggleBtn = Instance.new("ImageButton")
toggleBtn.Size = UDim2.new(0,60,0,60)
toggleBtn.Position = UDim2.new(0,10,0,10)
toggleBtn.BackgroundTransparency = 1
toggleBtn.Image = "rbxassetid://6031097227" -- ícone de hack (mude se quiser)
toggleBtn.Parent = screenGui

-- Frame principal (menu)
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0,260,0,450)
mainFrame.Position = UDim2.new(0,10,0,80)
mainFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
mainFrame.BorderSizePixel = 0
mainFrame.Visible = false
mainFrame.Parent = screenGui

local layout = Instance.new("UIListLayout")
layout.Padding = UDim.new(0,5)
layout.FillDirection = Enum.FillDirection.Vertical
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.Parent = mainFrame

-- Toggle menu ao clicar na bolinha
toggleBtn.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
end)

-- Função para criar botão
local function createButton(text, color, parent)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0,240,0,35)
    btn.Text = text
    btn.BackgroundColor3 = color
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextScaled = true
    btn.BorderSizePixel = 0
    btn.Parent = parent
    return btn
end

-- Função para criar slider
local function createSlider(labelText, min, max, default, parent, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0,240,0,50)
    frame.BackgroundColor3 = Color3.fromRGB(50,50,50)
    frame.BorderSizePixel = 0
    frame.Visible = false
    frame.Parent = parent

    local label = Instance.new("TextLabel")
    label.Text = labelText..": "..default
    label.Size = UDim2.new(1,0,0,20)
    label.TextColor3 = Color3.new(1,1,1)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.SourceSansBold
    label.TextScaled = true
    label.Parent = frame

    local slider = Instance.new("TextButton")
    slider.Size = UDim2.new(1,0,0,20)
    slider.Position = UDim2.new(0,0,0,25)
    slider.BackgroundColor3 = Color3.fromRGB(100,100,100)
    slider.Text = ""
    slider.BorderSizePixel = 0
    slider.Parent = frame

    local dragging = false
    slider.MouseButton1Down:Connect(function() dragging = true end)
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
    end)
    RunService.RenderStepped:Connect(function()
        if dragging then
            local mouse = UserInputService:GetMouseLocation()
            local posX = math.clamp(mouse.X - slider.AbsolutePosition.X,0,slider.AbsoluteSize.X)
            local value = min + (posX / slider.AbsoluteSize.X) * (max-min)
            callback(value)
            label.Text = labelText..": "..math.floor(value)
        end
    end)

    return frame
end

-- Botões principais
local noclipBtn = createButton("Noclip OFF", Color3.fromRGB(255,0,0), mainFrame)
local flyBtn = createButton("Fly OFF", Color3.fromRGB(0,0,255), mainFrame)
local speedBtn = createButton("Speed OFF", Color3.fromRGB(255,140,0), mainFrame)
local healthBtn = createButton("Vida OFF", Color3.fromRGB(0,255,0), mainFrame)
local espBtn = createButton("ESP OFF", Color3.fromRGB(255,0,255), mainFrame)
local tpBtn = createButton("TP", Color3.fromRGB(0,150,255), mainFrame)

-- Sliders escondidos dentro dos botões
local flySlider = createSlider("FlySpeed", 10, 200, flySpeed, mainFrame, function(val) flySpeed = val end)
local speedSlider = createSlider("WalkSpeed", 8, 100, walkSpeed, mainFrame, function(val) walkSpeed = val end)

-- Toggle ESP
espBtn.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    espBtn.Text = espEnabled and "ESP ON" or "ESP OFF"
    if not espEnabled then
        for _,v in pairs(screenGui:GetChildren()) do
            if v.Name == "ESP_NAME" then v:Destroy() end
        end
    end
end)

-- Atualizar ESP
RunService.RenderStepped:Connect(function()
    if espEnabled then
        for _,pl in pairs(Players:GetPlayers()) do
            if pl ~= player and pl.Character and pl.Character:FindFirstChild("Head") then
                local head = pl.Character.Head
                local pos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(head.Position + Vector3.new(0,2,0))

                local tag = screenGui:FindFirstChild(pl.Name.."_ESP")
                if not tag then
                    tag = Instance.new("TextLabel")
                    tag.Name = pl.Name.."_ESP"
                    tag.Text = pl.Name
                    tag.Size = UDim2.new(0,200,0,20)
                    tag.BackgroundTransparency = 1
                    tag.TextColor3 = Color3.fromRGB(255,0,0)
                    tag.Font = Enum.Font.SourceSansBold
                    tag.TextScaled = true
                    tag.Parent = screenGui
                end

                if onScreen then
                    tag.Visible = true
                    tag.Position = UDim2.new(0,pos.X-100,0,pos.Y-10)
                else
                    tag.Visible = false
                end
            end
        end
    end
end)
